<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>منصة قسم الإحصاء</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- NEW MODERN UI STYLES --- */
        :root {
            --primary-color: #1a237e; /* Deep Indigo */
            --secondary-color: #3949ab; /* Lighter Indigo */
            --accent-color: #ffa000; /* Amber */
            --background-color: #f5f7fa; /* Light Gray */
            --surface-color: #ffffff;
            --text-color: #1c1e21; /* Dark Gray */
            --subtle-text-color: #606770;
            --border-color: #e0e0e0;
            --danger-color: #d32f2f;
            --success-color: #388e3c;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
            --border-radius: 12px;
            --font-family: 'Cairo', sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.7;
            font-size: 16px;
        }
        
        body::before {
            content: "";
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            z-index: -1;
            background: radial-gradient(circle at 80% 20%, #ffa00033 0%, transparent 60%),
                        radial-gradient(circle at 20% 80%, #3949ab33 0%, transparent 60%),
                        linear-gradient(135deg, #f5f7fa 0%, #e3e6f3 100%);
            animation: bgMove 12s ease-in-out infinite alternate;
            transition: background 0.5s;
        }

        @keyframes bgMove {
            0% { background-position: 80% 20%, 20% 80%, 0% 0%; }
            50% { background-position: 70% 30%, 30% 70%, 100% 100%; }
            100% { background-position: 60% 40%, 40% 60%, 0% 100%; }
        }

        .container {
            max-width: 1300px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* --- Header --- */
        header {
            background: var(--surface-color);
            color: var(--primary-color);
            padding: 1.5rem 0;
            text-align: center;
            box-shadow: var(--shadow-sm);
            border-bottom: 1px solid var(--border-color);
            animation: headerFadeIn 1s cubic-bezier(.4,0,.2,1);
        }
        @keyframes headerFadeIn {
            0% { opacity: 0; transform: translateY(-40px) scale(0.96);}
            70% { opacity: 1; transform: translateY(8px) scale(1.04);}
            100% { opacity: 1; transform: translateY(0) scale(1);}
        }
        header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            cursor: pointer;
        }
        header h1 i {
            color: var(--accent-color);
        }

        /* --- Footer --- */
        footer {
            text-align: center;
            padding: 2rem;
            margin-top: 3rem;
            background-color: #212121;
            color: #bdbdbd;
            animation: footerFadeIn 1.2s cubic-bezier(.4,0,.2,1);
        }
        @keyframes footerFadeIn {
            0% { opacity: 0; transform: translateY(40px) scale(0.96);}
            70% { opacity: 1; transform: translateY(-8px) scale(1.04);}
            100% { opacity: 1; transform: translateY(0) scale(1);}
        }
        footer a {
            color: var(--accent-color);
            text-decoration: none;
            font-weight: 600;
        }
        footer a:hover {
            text-decoration: underline;
        }
        .footer-credits {
            margin-top: 0.5rem;
            font-size: 0.9rem;
            animation: creditsFade 1.2s cubic-bezier(.4,0,.2,1) 0.6s both;
        }
        @keyframes creditsFade {
            0% { opacity: 0; transform: translateY(20px);}
            100% { opacity: 1; transform: translateY(0);}
        }
        .footer-copyright-animated {
            animation: copyrightPop 1.2s cubic-bezier(.4,0,.2,1) 0.2s both;
        }
        @keyframes copyrightPop {
            0% { opacity: 0; transform: translateY(30px) scale(0.95);}
            60% { opacity: 1; transform: translateY(-6px) scale(1.04);}
            100% { opacity: 1; transform: translateY(0) scale(1);}
        }
        .footer-btn-animated {
            animation: btnPop 1.2s cubic-bezier(.4,0,.2,1) 1s both;
        }
        @keyframes btnPop {
            0% { opacity: 0; transform: scale(0.9);}
            60% { opacity: 1; transform: scale(1.08);}
            100% { opacity: 1; transform: scale(1);}
        }

        /* --- Views & Transitions --- */
        .view {
            display: none;
            animation: fadeIn 0.4s ease-out;
        }
        .view.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* --- Hero Section --- */
        .hero-section {
            padding: 3rem 2rem;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: var(--border-radius);
            text-align: center;
            margin-bottom: 3rem;
            animation: heroFadeIn 1.2s cubic-bezier(.4,0,.2,1);
        }
        @keyframes heroFadeIn {
            0% { opacity: 0; transform: scale(0.96) translateY(40px); }
            70% { opacity: 1; transform: scale(1.02) translateY(-8px); }
            100% { opacity: 1; transform: scale(1) translateY(0); }
        }
        .hero-section h2 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            animation: heroTitlePop 1.2s cubic-bezier(.4,0,.2,1) 0.2s both;
        }
        @keyframes heroTitlePop {
            0% { opacity: 0; transform: translateY(30px) scale(0.95);}
            60% { opacity: 1; transform: translateY(-6px) scale(1.04);}
            100% { opacity: 1; transform: translateY(0) scale(1);}
        }
        .hero-section p {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto;
            opacity: 0.9;
            animation: heroTextFade 1.2s cubic-bezier(.4,0,.2,1) 0.5s both;
        }
        @keyframes heroTextFade {
            0% { opacity: 0; transform: translateY(20px);}
            100% { opacity: 1; transform: translateY(0);}
        }


        /* --- Cards --- */
        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }
        .card {
            background: var(--surface-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            overflow: hidden;
        }
        .card:hover {
            transform: translateY(-10px);
            box-shadow: 0 16px 32px rgba(0,0,0,0.1);
        }
        .card-content {
            padding: 2rem;
            text-align: center;
        }
        .card-icon-background {
            width: 80px;
            height: 80px;
            margin: 0 auto 1.5rem auto;
            border-radius: 50%;
            background-color: var(--background-color);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s ease;
        }
        .card:hover .card-icon-background {
            background-color: var(--accent-color);
        }
        .card:hover .card-icon-background i {
            color: var(--surface-color);
        }
        .card h3 {
            color: var(--primary-color);
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }
        .card-stats {
            color: var(--subtle-text-color);
            font-size: 1rem;
            font-weight: 600;
        }
        .card i {
            font-size: 2.5rem;
            color: var(--secondary-color);
            transition: color 0.3s ease;
        }
        .card-action {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            background-color: var(--background-color);
            font-weight: 700;
            color: var(--primary-color);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .card:hover .card-action {
            background-color: var(--primary-color);
            color: white;
        }

        /* --- Buttons --- */
        .btn {
            background-color: var(--secondary-color);
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            font-family: var(--font-family);
            transition: all 0.2s ease-in-out;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-decoration: none;
        }
        .btn:hover {
            background-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .btn-danger { background-color: var(--danger-color); }
        .btn-danger:hover { background-color: #b71c1c; }
        .btn-success { background-color: var(--success-color); }
        .btn-success:hover { background-color: #2e7d32; }
        .btn-warning { background-color: var(--accent-color); color: var(--primary-color); }
        .btn-warning:hover { background-color: #ff8f00; }
        .btn-sm { padding: 0.4rem 0.8rem; font-size: 0.8rem; }

        /* --- Breadcrumbs --- */
        #breadcrumbs-container {
            margin-bottom: 2rem;
            padding: 1rem;
            background-color: var(--surface-color);
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 600;
            box-shadow: var(--shadow-sm);
        }
        #breadcrumbs-container a { color: var(--secondary-color); text-decoration: none; }
        #breadcrumbs-container a:hover { text-decoration: underline; }
        #breadcrumbs-container span { color: var(--subtle-text-color); }

        /* --- Material Details --- */
        #material-details-content {
            background: var(--surface-color);
            padding: 2.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
        }
        .details-header {
            padding-bottom: 1.5rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        .details-header h2 {
            font-size: 2.2rem;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }
        .details-header p {
            font-size: 1.1rem;
            color: var(--subtle-text-color);
        }
        .details-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2.5rem;
        }
        .sidebar h3, .main-content h3 {
            margin-bottom: 1rem;
            color: var(--primary-color);
            font-size: 1.3rem;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 0.5rem;
            display: inline-block;
        }
        .metadata-list {
            list-style: none;
            padding: 0;
        }
        .metadata-list li {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.8rem 0;
            font-size: 1rem;
            border-bottom: 1px solid var(--background-color);
        }
        .metadata-list li:last-child {
            border-bottom: none;
        }
        .metadata-list i {
            color: var(--secondary-color);
            font-size: 1.5rem;
            width: 30px;
            text-align: center;
        }
        .metadata-list div {
            display: flex;
            flex-direction: column;
        }
        .metadata-list span {
            color: var(--subtle-text-color);
        }
        .share-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }
        .file-list a {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: var(--background-color);
            color: var(--text-color);
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.2s ease;
            font-weight: 600;
            border: 1px solid var(--border-color);
        }
        .file-list a:hover { background-color: var(--success-color); color: white; border-color: var(--success-color); }
        .image-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        .image-gallery img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .image-gallery img:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-md);
        }
        
        /* --- Login & Admin Forms --- */
        .form-container {
            background: var(--surface-color);
            padding: 3rem;
            border-radius: var(--border-radius);
            max-width: 500px;
            margin: 3rem auto;
            box-shadow: var(--shadow-md);
        }
        .form-container h2 { text-align: center; margin-bottom: 2rem; color: var(--primary-color); }
        input[type="text"], input[type="email"], input[type="password"], input[type="url"], select, textarea {
            width: 100%;
            padding: 0.8rem 1rem;
            margin-bottom: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-sizing: border-box;
            font-family: var(--font-family);
            font-size: 1rem;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(57, 73, 171, 0.2);
        }
        .error-message { color: var(--danger-color); margin-top: 1rem; text-align: center; font-weight: 600; }
        
        /* --- Admin Dashboard --- */
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }
        .admin-section {
            background: var(--surface-color);
            padding: 2rem;
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
            box-shadow: var(--shadow-md);
        }
        .admin-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        .tab-link {
            padding: 0.8rem 1.5rem;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--subtle-text-color);
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }
        .tab-link.active, .tab-link:hover {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.5s; }

        .admin-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
        }
        .form-column { grid-column: 1 / 2; }
        .list-column { grid-column: 2 / 3; }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95rem;
        }
        .data-table th, .data-table td {
            text-align: right;
            padding: 0.8rem 1rem;
            border-bottom: 1px solid var(--border-color);
        }
        .data-table th {
            background-color: var(--background-color);
            font-weight: 700;
            color: var(--primary-color);
        }
        .data-table tr:last-child td { border-bottom: none; }
        .data-table .actions { display: flex; gap: 0.5rem; }
        .badge {
            padding: 0.2rem 0.6rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            color: white;
        }
        .badge.superadmin { background-color: var(--primary-color); }
        .badge.admin { background-color: var(--secondary-color); }
        .badge.user { background-color: var(--subtle-text-color); }

        /* --- Modal/Alert Box --- */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(28, 30, 33, 0.6);
            backdrop-filter: blur(5px);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.visible { opacity: 1; visibility: visible; }
        .modal-content {
            background: var(--surface-color);
            padding: 2.5rem;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 500px;
            text-align: center;
            position: relative;
            transform: translateY(20px) scale(0.95);
            transition: transform 0.3s ease;
        }
        .modal-overlay.visible .modal-content { transform: translateY(0) scale(1); }
        .modal-content h2 { color: var(--primary-color); }
        .close-btn {
            position: absolute;
            top: 1rem; left: 1rem;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--subtle-text-color);
            border: none;
            background: none;
            width: 30px;
            height: 30px;
            line-height: 30px;
            border-radius: 50%;
            transition: background-color 0.2s;
        }
        .close-btn:hover { background-color: var(--background-color); }
        
        /* --- Edit Material Modal Specifics --- */
        #edit-material-modal .modal-content {
            max-height: 85vh;
            display: flex;
            flex-direction: column;
        }
        #edit-modal-body {
            overflow-y: auto;
            padding-left: 15px; /* Add some space for the scrollbar */
            text-align: right;
        }
        /* Custom Scrollbar for Webkit browsers */
        #edit-modal-body::-webkit-scrollbar {
            width: 8px;
        }
        #edit-modal-body::-webkit-scrollbar-track {
            background: var(--background-color);
            border-radius: 10px;
        }
        #edit-modal-body::-webkit-scrollbar-thumb {
            background: var(--secondary-color);
            border-radius: 10px;
        }
        #edit-modal-body::-webkit-scrollbar-thumb:hover {
            background: var(--primary-color);
        }

        /* --- Lightbox Modal --- */
        #lightbox-modal {
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(8px);
        }
        #lightbox-image {
            max-width: 90vw;
            max-height: 90vh;
            object-fit: contain;
            border-radius: var(--border-radius);
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }
        #lightbox-modal .close-btn {
            top: 1rem;
            left: 1.5rem;
            color: white;
            font-size: 2.5rem;
            font-weight: bold;
        }

        /* --- Dynamic Form Styles --- */
        .section-item {
            background: var(--background-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .section-header {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        .link-item {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        .link-item input { margin-bottom: 0; }
        .link-item .link-inputs { flex-grow: 1; }

        /* --- Loader --- */
        .loader { text-align: center; padding: 4rem; font-size: 1.2rem; font-weight: 600; }

        /* --- Responsive Adjustments --- */
         @media (max-width: 900px) {
            .container { padding: 1.5rem; }
            .cards-container { gap: 1.2rem; }
            .admin-grid { grid-template-columns: 1fr; gap: 1.5rem; }
            .form-column, .list-column { grid-column: auto; }
        }
        @media (max-width: 600px) {
            .container { padding: 1rem; }
            header h1 { font-size: 1.8rem; }
            .hero-section { padding: 2rem 1rem; }
            .hero-section h2 { font-size: 1.8rem; }
            .cards-container { grid-template-columns: 1fr; gap: 1rem; }
            .admin-header { flex-direction: column; gap: 1rem; align-items: flex-start; }
            .admin-tabs { flex-direction: column; gap: 0.5rem; }
            .tab-link { width: 100%; text-align: right; }
            .details-header { flex-direction: column; gap: 1rem; }
            .details-header h2 { font-size: 1.8rem; }
        }

    </style>
</head>
<body>

    <!-- Modals -->
    <div id="disclaimer-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="close-btn" onclick="document.getElementById('disclaimer-modal').classList.remove('visible')">&times;</button>
            <h2><i class="fas fa-bullhorn"></i> تنويه هام</h2>
            <p style="font-size: 1.1rem; line-height: 1.8;">هذه المنصة هي مبادرة طلابية تطوعية، تم إنشاؤها كجهد شخصي بهدف تسهيل الوصول إلى المواد الدراسية وتعزيز التعاون بين طلبة قسم الإحصاء.</p>
            <p style="margin-top: 1rem;">نود التأكيد على أن هذه المنصة <strong>لا تمثل الكلية أو القسم بشكل رسمي</strong>، ولا يوجد أي ارتباط إداري أو أكاديمي معها.</p>
            <p style="font-weight: 600; margin-top: 1.5rem; color: var(--primary-color);">نتمنى لكم كل التوفيق في رحلتكم التعليمية!</p>
        </div>
    </div>
    <div id="confirm-modal" class="modal-overlay">
        <div class="modal-content">
            <h2 id="confirm-title">تأكيد الإجراء</h2>
            <p id="confirm-text">هل أنت متأكد أنك تريد المتابعة؟</p>
            <div style="margin-top: 20px; display: flex; justify-content: center; gap: 15px;">
                <button id="confirm-yes-btn" class="btn btn-danger">نعم، تأكيد</button>
                <button id="confirm-no-btn" class="btn">إلغاء</button>
            </div>
        </div>
    </div>
    <div id="lightbox-modal" class="modal-overlay" onclick="closeLightbox()">
        <button class="close-btn" onclick="closeLightbox()">&times;</button>
        <img id="lightbox-image" src="" alt="صورة مكبرة" onclick="event.stopPropagation()">
    </div>
    <div id="edit-material-modal" class="modal-overlay">
        <div class="modal-content" style="max-width: 800px;">
            <button class="close-btn" onclick="closeEditModal()">&times;</button>
            <h2 id="edit-modal-title" style="margin-bottom: 1.5rem; text-align: right;">تعديل المادة</h2>
            <div id="edit-modal-body"></div>
        </div>
    </div>

    <header>
        <div class="container">
            <h1 onclick="navigateTo('#/')" style="cursor:pointer;"><i class="fas fa-chart-pie"></i> منصة قسم الإحصاء</h1>
        </div>
    </header>

    <main class="container">
        <div id="breadcrumbs-container"></div>
        <div id="stages-view" class="view"></div>
        <div id="courses-view" class="view"></div>
        <div id="materials-view" class="view"></div>
        <div id="material-details-view" class="view"></div>
        <div id="login-view" class="view"></div>
        <div id="admin-view" class="view"></div>
        <div id="loader" class="loader" style="display: none;"><i class="fas fa-spinner fa-spin"></i> جاري التحميل...</div>
    </main>

    <footer>
        <p>جميع الحقوق محفوظة © <span id="current-year"></span></p>
        <div class="footer-credits">
            <span id="founder-credit"></span>
        </div>
        <a href="#/login" id="admin-login-link">دخول المشرفين</a>
    </footer>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
        const _0x468667=_0x2b96;function _0x2b96(_0x4603d9,_0x1047c7){const _0x122e86=_0x122e();return _0x2b96=function(_0x2b96e6,_0x4a301f){_0x2b96e6=_0x2b96e6-0x7f;let _0x21057d=_0x122e86[_0x2b96e6];return _0x21057d;},_0x2b96(_0x4603d9,_0x1047c7);}(function(_0x47308d,_0x1c5dbe){const _0x3a9191=_0x2b96,_0x46d9c0=_0x47308d();while(!![]){try{const _0x2730a0=parseInt(_0x3a9191(0x8c))/0x1*(parseInt(_0x3a9191(0x7f))/0x2)+-parseInt(_0x3a9191(0x88))/0x3*(parseInt(_0x3a9191(0x81))/0x4)+-parseInt(_0x3a9191(0x89))/0x5+parseInt(_0x3a9191(0x85))/0x6+parseInt(_0x3a9191(0x8a))/0x7+-parseInt(_0x3a9191(0x84))/0x8+parseInt(_0x3a9191(0x87))/0x9;if(_0x2730a0===_0x1c5dbe)break;else _0x46d9c0['push'](_0x46d9c0['shift']());}catch(_0x4872c9){_0x46d9c0['push'](_0x46d9c0['shift']());}}}(_0x122e,0x31fad));function _0x122e(){const _0xb4df5a=['3yUoJzn','1483250niFRnF','1456784esJfHw','stat-118ce.firebaseapp.com','215701gKjbtL','2LXUqLu','stat-118ce.appspot.com','575584FVOVWX','AIzaSyAl_pb8TJ4jjyef0mFDboNOfXA1n1GtDvA','1:134267439052:web:8e029f779bf564ed09bf69','3015256aUFxeP','1501242SFSTCr','134267439052','3133350mvdVEf'];_0x122e=function(){return _0xb4df5a;};return _0x122e();}const firebaseConfig={'apiKey':_0x468667(0x82),'authDomain':_0x468667(0x8b),'projectId':'stat-118ce','storageBucket':_0x468667(0x80),'messagingSenderId':_0x468667(0x86),'appId':_0x468667(0x83)};

       const _0x332b4f=_0x3d29;(function(_0x2a0d89,_0x163980){const _0xea28af=_0x3d29,_0x3a615=_0x2a0d89();while(!![]){try{const _0x2c68de=-parseInt(_0xea28af(0x77))/0x1+-parseInt(_0xea28af(0x71))/0x2*(parseInt(_0xea28af(0x75))/0x3)+-parseInt(_0xea28af(0x6e))/0x4+-parseInt(_0xea28af(0x76))/0x5*(-parseInt(_0xea28af(0x70))/0x6)+-parseInt(_0xea28af(0x74))/0x7*(parseInt(_0xea28af(0x7b))/0x8)+parseInt(_0xea28af(0x78))/0x9+-parseInt(_0xea28af(0x7a))/0xa*(-parseInt(_0xea28af(0x6f))/0xb);if(_0x2c68de===_0x163980)break;else _0x3a615['push'](_0x3a615['shift']());}catch(_0x53a393){_0x3a615['push'](_0x3a615['shift']());}}}(_0x317d,0xd54ef),firebase[_0x332b4f(0x73)](firebaseConfig));function _0x3d29(_0x2c9f9d,_0x250399){const _0x317d07=_0x317d();return _0x3d29=function(_0x3d2976,_0xa56e5b){_0x3d2976=_0x3d2976-0x6e;let _0x75f280=_0x317d07[_0x3d2976];return _0x75f280;},_0x3d29(_0x2c9f9d,_0x250399);}const auth=firebase[_0x332b4f(0x72)](),db=firebase[_0x332b4f(0x79)]();function _0x317d(){const _0x5c4032=['265901gLgusc','14268852MpYyhM','firestore','209630vthlAD','8936ZnIZtd','4403912StUQSp','517fkWvZt','18CwjNJr','60442fRcpPY','auth','initializeApp','7945jBRJrh','21YMXuQB','1915405GrbymS'];_0x317d=function(){return _0x5c4032;};return _0x317d();}

        const views = document.querySelectorAll('.view');
        const loader = document.getElementById('loader');
        const breadcrumbsContainer = document.getElementById('breadcrumbs-container');
        const adminLoginLink = document.getElementById('admin-login-link');
        
        let currentUser = null;
        let currentUserData = null; 
        let userRole = null; 

        function navigateTo(hash) { window.location.hash = hash || '#/'; }

        function router() {
            const path = window.location.hash.slice(1) || '/';
            const parts = path.split('/').filter(p => p);
            
            let viewName = 'stages'; 
            let routeParams = {};
            
            if (parts[0] === 'stage' && parts.length === 2) {
                viewName = 'courses';
                routeParams = { stageId: parts[1] };
            } else if (parts[0] === 'stage' && parts.length === 4 && parts[2] === 'course') {
                viewName = 'materials';
                routeParams = { stageId: parts[1], courseId: parts[3] };
            } else if (parts[0] === 'stage' && parts.length === 6 && parts[2] === 'course' && parts[4] === 'material') {
                viewName = 'material-details';
                routeParams = { stageId: parts[1], courseId: parts[3], materialId: parts[5] };
            } else if (parts[0] === 'login') {
                viewName = 'login';
            } else if (parts[0] === 'admin') {
                if (!currentUser) { navigateTo('#/login'); return; }
                viewName = 'admin';
            }
            
            renderView(viewName, routeParams);
        }

        async function renderView(viewName, params = {}) {
            views.forEach(v => v.classList.remove('active'));
            const viewContainer = document.getElementById(`${viewName}-view`);
            
            if (viewContainer) {
                loader.style.display = 'block';
                viewContainer.innerHTML = '';
                
                switch (viewName) {
                    case 'stages':
                        await renderStagesView(viewContainer);
                        break;
                    case 'courses':
                        renderCoursesView(viewContainer, params.stageId);
                        break;
                    case 'materials':
                        await renderMaterialsView(viewContainer, params.stageId, params.courseId);
                        break;
                    case 'material-details':
                        await renderMaterialDetailsView(viewContainer, params.materialId);
                        break;
                    case 'login':
                        renderLoginView(viewContainer);
                        break;
                    case 'admin':
                        await renderAdminView(viewContainer);
                        break;
                    default:
                        await renderStagesView(viewContainer);
                }

                loader.style.display = 'none';
                viewContainer.classList.add('active');
                updateBreadcrumbs(viewName, params);
            } else {
                console.error(`[Render] View container for "${viewName}" not found! Check if the ID "${viewName}-view" exists in your HTML.`);
            }
        }
        
        function updateBreadcrumbs(viewName, params) {
            if(viewName === 'stages' || viewName === 'login' || viewName === 'admin') {
                breadcrumbsContainer.style.display = 'none';
                return;
            }
            breadcrumbsContainer.style.display = 'block';

            let html = `<a href="#/"><i class="fas fa-home"></i> الرئيسية</a>`;
            const stageNames = ['الأولى', 'الثانية', 'الثالثة', 'الرابعة'];
            const courseNames = ['الأول', 'الثاني'];

            if (params.stageId) html += ` / <a href="#/stage/${params.stageId}">المرحلة ${stageNames[params.stageId - 1]}</a>`;
            if (params.courseId) html += ` / <a href="#/stage/${params.stageId}/course/${params.courseId}">الكورس ${courseNames[params.courseId - 1]}</a>`;
            if (viewName === 'material-details') html += ` / <span>تفاصيل المادة</span>`;
            
            breadcrumbsContainer.innerHTML = html;
        }

        // --- View Rendering Functions ---
        async function renderStagesView(container) {
            container.innerHTML = `
                <div class="hero-section">
                    <h2>أهلاً بك في</h2>
                    <p>المنصة المركزية للوصول إلى جميع المواد والمحاضرات الخاصة بقسم الإحصاء. نتمنى لك رحلة تعليمية موفقة ومثمرة.</p>
                </div>
                <div class="cards-container" id="stages-card-container">
                    <div class="loader">جاري تحميل المراحل...</div>
                </div>
            `;

            const stages = [
                { id: '1', name: 'المرحلة الأولى', icon: 'fa-graduation-cap' },
                { id: '2', name: 'المرحلة الثانية', icon: 'fa-book-open' },
                { id: '3', name: 'المرحلة الثالثة', icon: 'fa-microscope' },
                { id: '4', name: 'المرحلة الرابعة', icon: 'fa-award' }
            ];

            const countPromises = stages.map(stage =>
                db.collection('materials').where('stage', '==', stage.id).get().then(snap => snap.size)
            );

            const counts = await Promise.all(countPromises);

            const cardContainer = document.getElementById('stages-card-container');
            cardContainer.innerHTML = stages.map((stage, index) => `
                <div class="card" onclick="navigateTo('#/stage/${stage.id}')">
                    <div class="card-content">
                        <div class="card-icon-background">
                            <i class="fas ${stage.icon}"></i>
                        </div>
                        <h3>${stage.name}</h3>
                        <p class="card-stats">${counts[index]} مادة متاحة</p>
                    </div>
                    <div class="card-action">
                        <span>استعراض المواد</span>
                        <i class="fas fa-arrow-left"></i>
                    </div>
                </div>`).join('');
        }

        function renderCoursesView(container, stageId) {
             const courses = [ { id: '1', name: 'الكورس الأول', icon: 'fa-hourglass-start' }, { id: '2', name: 'الكورس الثاني', icon: 'fa-hourglass-end' }];
             container.innerHTML = `<div class="cards-container">${courses.map(course => `
                <div class="card" onclick="navigateTo('#/stage/${stageId}/course/${course.id}')">
                     <div class="card-content">
                        <div class="card-icon-background">
                            <i class="fas ${course.icon}"></i>
                        </div>
                        <h3>${course.name}</h3>
                    </div>
                    <div class="card-action">
                        <span>استعراض المواد</span>
                        <i class="fas fa-arrow-left"></i>
                    </div>
                </div>`).join('')}</div>`;
        }

        async function renderMaterialsView(container, stageId, courseId) {
            const snapshot = await db.collection('materials').where('stage', '==', stageId).where('course', '==', courseId).get();
            if (snapshot.empty) {
                container.innerHTML = '<p style="text-align:center; font-size: 1.2rem; padding: 3rem 0;">لا توجد مواد مضافة حالياً لهذا الكورس.</p>';
                return;
            }
            container.innerHTML = `<div class="cards-container">${snapshot.docs.map(doc => {
                const material = doc.data();
                return `<div class="card" onclick="navigateTo('#/stage/${stageId}/course/${courseId}/material/${doc.id}')">
                            <div class="card-content">
                                <div class="card-icon-background">
                                    <i class="fas fa-book-reader"></i>
                                </div>
                                <h3>${material.name}</h3>
                                <p class="card-stats">${material.profName}</p>
                            </div>
                            <div class="card-action">
                                <span>عرض التفاصيل</span>
                                <i class="fas fa-arrow-left"></i>
                            </div>
                        </div>`;
            }).join('')}</div>`;
        }

        async function renderMaterialDetailsView(container, materialId) {
            try {
                const doc = await db.collection('materials').doc(materialId).get();
                if (!doc.exists) { 
                    container.innerHTML = '<p>المادة غير موجودة.</p>'; 
                    return; 
                }
                const data = doc.data();
                
                const editButtonHTML = (userRole === 'admin' || userRole === 'superadmin') ?
                    `<button class="btn btn-warning" onclick="openEditModal('${materialId}')"><i class="fas fa-edit"></i> تعديل المادة</button>` : '';

                let sectionsHTML = '';
                if (data.sections && data.sections.length > 0) {
                    sectionsHTML = data.sections.map(section => `
                        <div class="material-section">
                            <h3><i class="fas fa-folder-open"></i> ${section.title}</h3>
                            <div class="file-list">
                                ${section.links.map(link => `
                                    <a href="${link.url}" target="_blank" onclick="incrementDownloadCount('${materialId}', '${link.title}')">
                                        <i class="fas fa-link"></i> ${link.title}
                                    </a>
                                `).join('')}
                            </div>
                        </div>
                    `).join('<hr style="margin: 2rem 0; border-color: var(--border-color);">');
                } else {
                    sectionsHTML = '<p>لا توجد ملفات أو أقسام مضافة لهذه المادة.</p>';
                }
                
                let addedDate = 'غير معروف';
                if (data.createdAt && data.createdAt.toDate) {
                    addedDate = new Intl.DateTimeFormat('ar-EG', { dateStyle: 'long' }).format(data.createdAt.toDate());
                }
                const materialLink = window.location.href;

                container.innerHTML = `
                    <div id="material-details-content">
                        <div class="details-header">
                            <div>
                                <h2>${data.name}</h2>
                                <p><i class="fas fa-user-tie"></i> الأستاذ: ${data.profName}</p>
                            </div>
                            <div>
                                ${editButtonHTML}
                            </div>
                        </div>
                        <div class="details-grid">
                            <div class="main-content">
                                ${sectionsHTML}
                            </div>
                            <aside class="sidebar">
                                <h3><i class="fas fa-info-circle"></i> معلومات إضافية</h3>
                                <ul class="metadata-list">
                                    <li>
                                        <i class="fas fa-calendar-alt"></i>
                                        <div><strong>تاريخ الإضافة</strong><span>${addedDate}</span></div>
                                    </li>
                                    <li>
                                        <i class="fas fa-download"></i>
                                        <div><strong>عدد التحميلات</strong><span>${data.downloads || 0}</span></div>
                                    </li>
                                </ul>
                                <h3 style="margin-top: 2rem;"><i class="fas fa-share-alt"></i> مشاركة المادة</h3>
                                <div class="share-buttons">
                                    <a href="https://api.whatsapp.com/send?text=${encodeURIComponent('مادة: ' + data.name + '\n' + materialLink)}" target="_blank" class="btn" style="background-color: #25D366;"><i class="fab fa-whatsapp"></i> واتساب</a>
                                    <a href="https://t.me/share/url?url=${encodeURIComponent(materialLink)}&text=${encodeURIComponent('مادة: ' + data.name)}" target="_blank" class="btn" style="background-color: #0088cc;"><i class="fab fa-telegram"></i> تيليجرام</a>
                                    <button class="btn" style="background-color: var(--subtle-text-color);" onclick="copyMaterialLink()"><i class="fas fa-copy"></i> نسخ الرابط</button>
                                </div>
                            </aside>
                        </div>
                    </div>`;
            } catch (error) {
                console.error("[Details View] Error fetching material details:", error);
                container.innerHTML = '<p style="text-align:center; color:red;">حدث خطأ أثناء عرض تفاصيل المادة. يرجى المحاولة مرة أخرى.</p>';
            }
        }

        function renderLoginView(container) {
            container.innerHTML = `
                <div class="form-container">
                    <h2>تسجيل دخول المشرفين</h2>
                    <form id="login-form">
                        <input type="email" id="email" placeholder="البريد الإلكتروني" required>
                        <input type="password" id="password" placeholder="كلمة المرور" required>
                        <button type="submit" class="btn" style="width: 100%;"><i class="fas fa-sign-in-alt"></i> دخول</button>
                        <p id="login-error" class="error-message"></p>
                    </form>
                </div>`;
            document.getElementById('login-form').addEventListener('submit', handleLogin);
        }

        async function renderAdminView(container) {
            container.innerHTML = `
                <div class="admin-header">
                    <h2><i class="fas fa-cogs"></i> لوحة التحكم</h2>
                    <button id="logout-btn" class="btn btn-danger"><i class="fas fa-sign-out-alt"></i> تسجيل الخروج</button>
                </div>
                <div class="admin-tabs">
                    <button class="tab-link active" data-tab="materials-tab">إدارة المواد</button>
                    ${userRole === 'superadmin' ? `
                        <button class="tab-link" data-tab="permissions-tab">المستخدمين والصلاحيات</button>
                        <button class="tab-link" data-tab="stats-tab">الإحصائيات</button>
                    ` : ''}
                    <button class="tab-link" data-tab="profile-tab">الصفحة الشخصية</button>
                </div>
                <div id="materials-tab" class="tab-content active"></div>
                <div id="permissions-tab" class="tab-content"></div>
                <div id="stats-tab" class="tab-content"></div>
                <div id="profile-tab" class="tab-content"></div>
            `;
            
            renderMaterialsManagementTab(document.getElementById('materials-tab'));
            renderProfileTab(document.getElementById('profile-tab'));
            if (userRole === 'superadmin') {
                renderPermissionsTab(document.getElementById('permissions-tab'));
                renderStatsTab(document.getElementById('stats-tab'));
            }

            document.getElementById('logout-btn').addEventListener('click', handleLogout);
            container.querySelectorAll('.tab-link').forEach(button => {
                button.addEventListener('click', () => {
                    container.querySelectorAll('.tab-link, .tab-content').forEach(el => el.classList.remove('active'));
                    button.classList.add('active');
                    document.getElementById(button.dataset.tab).classList.add('active');
                });
            });
        }

        // --- Admin Tab Renderers ---
        async function renderMaterialsManagementTab(container) {
            container.innerHTML = `
                <section class="admin-section">
                    <h2 id="material-form-title"><i class="fas fa-plus-circle"></i> إضافة / تعديل مادة</h2>
                    <div id="material-form-container"></div>
                </section>
            `;
            renderMaterialForm(document.getElementById('material-form-container'));
        }

        async function renderPermissionsTab(container) {
            container.innerHTML = `
                <section class="admin-section">
                    <h2><i class="fas fa-users-cog"></i> إدارة المستخدمين والصلاحيات</h2>
                    <div id="users-list"></div>
                </section>
            `;
            loadAllUsers();
        }

        async function renderStatsTab(container) {
            container.innerHTML = `
                <section class="admin-section">
                    <h2><i class="fas fa-chart-bar"></i> الإحصائيات</h2>
                    <div id="stats-grid" class="stats-grid"></div>
                    <h3 style="margin-top: 2rem;">تحميلات المواد</h3>
                    <div id="material-stats"></div>
                </section>
            `;
            loadStats();
        }

        function renderProfileTab(container) {
            container.innerHTML = `
                <section class="admin-section">
                    <h2><i class="fas fa-user-circle"></i> الصفحة الشخصية</h2>
                    <form id="profile-form">
                        <label for="profile-name">الاسم:</label>
                        <input type="text" id="profile-name" placeholder="اسمك الذي سيظهر للجميع" value="${currentUserData?.name || ''}" required>
                        
                        <label for="profile-email">البريد الإلكتروني:</label>
                        <input type="email" id="profile-email" value="${currentUser?.email || ''}" disabled>
                        
                        <button type="submit" class="btn"><i class="fas fa-save"></i> حفظ التغييرات</button>
                    </form>
                </section>
            `;
            document.getElementById('profile-form').addEventListener('submit', handleProfileUpdate);
        }

        function renderMaterialForm(container, initialData = {}, materialId = null) {
            container.innerHTML = `
                <form id="material-form" data-id="${materialId || ''}">
                    <input type="text" id="material-name" placeholder="اسم المادة" required value="${initialData.name || ''}">
                    <input type="text" id="prof-name" placeholder="اسم الأستاذ/الدكتور" required value="${initialData.profName || ''}">
                    <select id="stage-select" required>
                        <option value="">اختر المرحلة...</option>
                        <option value="1" ${initialData.stage === '1' ? 'selected' : ''}>الأولى</option>
                        <option value="2" ${initialData.stage === '2' ? 'selected' : ''}>الثانية</option>
                        <option value="3" ${initialData.stage === '3' ? 'selected' : ''}>الثالثة</option>
                        <option value="4" ${initialData.stage === '4' ? 'selected' : ''}>الرابعة</option>
                    </select>
                    <select id="course-select" required>
                        <option value="">اختر الكورس...</option>
                        <option value="1" ${initialData.course === '1' ? 'selected' : ''}>الأول</option>
                        <option value="2" ${initialData.course === '2' ? 'selected' : ''}>الثاني</option>
                    </select>
                    <hr style="margin: 1.5rem 0;">
                    <h3><i class="fas fa-folder-plus"></i> الأقسام والروابط</h3>
                    <div id="sections-container"></div>
                    <button type="button" class="btn btn-sm" id="add-section-btn"><i class="fas fa-plus"></i> إضافة قسم جديد</button>
                    <hr style="margin: 1.5rem 0;">
                    <button type="submit" class="btn" style="width: 100%;"><i class="fas fa-save"></i> حفظ المادة</button>
                </form>
            `;

            const sectionsContainer = container.querySelector('#sections-container');
            
            const addSection = (section = { title: '', links: [{ title: '', url: '' }] }) => {
                const sectionId = `section-${Date.now()}`;
                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'section-item';
                sectionDiv.innerHTML = `
                    <div class="section-header">
                        <input type="text" class="section-title-input" placeholder="عنوان القسم (مثال: محاضرات PDF)" value="${section.title}" required>
                        <button type="button" class="btn btn-danger btn-sm remove-section-btn"><i class="fas fa-trash"></i></button>
                    </div>
                    <div class="links-container"></div>
                    <button type="button" class="btn btn-sm add-link-btn"><i class="fas fa-plus"></i> إضافة رابط</button>
                `;
                sectionsContainer.appendChild(sectionDiv);

                const linksContainer = sectionDiv.querySelector('.links-container');
                const addLinkBtn = sectionDiv.querySelector('.add-link-btn');
                
                const addLink = (link = { title: '', url: '' }) => {
                    const linkDiv = document.createElement('div');
                    linkDiv.className = 'link-item';
                    linkDiv.innerHTML = `
                        <div class="link-inputs">
                            <input type="text" class="link-title-input" placeholder="عنوان الرابط" value="${link.title}" required>
                            <input type="url" class="link-url-input" placeholder="رابط الملف" value="${link.url}" required>
                        </div>
                        <button type="button" class="btn btn-danger btn-sm remove-link-btn"><i class="fas fa-times"></i></button>
                    `;
                    linksContainer.appendChild(linkDiv);
                    linkDiv.querySelector('.remove-link-btn').onclick = () => linkDiv.remove();
                };

                section.links.forEach(addLink);
                addLinkBtn.onclick = () => addLink();
                sectionDiv.querySelector('.remove-section-btn').onclick = () => sectionDiv.remove();
            };
            
            if (initialData.sections && initialData.sections.length > 0) {
                initialData.sections.forEach(addSection);
            } else {
                addSection(); // Add one empty section by default
            }

            container.querySelector('#add-section-btn').onclick = () => addSection();
            container.querySelector('#material-form').addEventListener('submit', handleMaterialSubmit);
        }


        // --- Event Handlers & Logic ---
        async function handleLogin(e) {
            e.preventDefault();
            const [email, password] = [document.getElementById('email').value, document.getElementById('password').value];
            const errorEl = document.getElementById('login-error');
            try { await auth.signInWithEmailAndPassword(email, password); } 
            catch (error) { errorEl.textContent = 'البريد الإلكتروني أو كلمة المرور غير صحيحة.'; }
        }

        function handleLogout() { auth.signOut(); }

        async function handleProfileUpdate(e) {
            e.preventDefault();
            const newName = document.getElementById('profile-name').value;
            const submitBtn = e.target.querySelector('button');
            submitBtn.disabled = true;
            
            try {
                await db.collection('users').doc(currentUser.uid).set({ name: newName }, { merge: true });
                alert('تم تحديث ملفك الشخصي بنجاح!');
                if (userRole === 'superadmin') {
                    loadFounderName();
                }
            } catch (error) {
                console.error("Error updating profile:", error);
                alert('حدث خطأ أثناء تحديث الملف الشخصي.');
            } finally {
                submitBtn.disabled = false;
            }
        }

        async function handleMaterialSubmit(e) {
            e.preventDefault();
            const form = e.target;
            const submitBtn = form.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري الحفظ...';

            const materialId = form.dataset.id;
            const sections = [];
            form.querySelectorAll('.section-item').forEach(sectionDiv => {
                const sectionTitle = sectionDiv.querySelector('.section-title-input').value.trim();
                const links = [];
                sectionDiv.querySelectorAll('.link-item').forEach(linkDiv => {
                    const linkTitle = linkDiv.querySelector('.link-title-input').value.trim();
                    const linkUrl = linkDiv.querySelector('.link-url-input').value.trim();
                    if (linkTitle && linkUrl) {
                        links.push({ title: linkTitle, url: linkUrl });
                    }
                });
                if (sectionTitle && links.length > 0) {
                    sections.push({ title: sectionTitle, links: links });
                }
            });

            const materialData = {
                stage: form.querySelector('#stage-select').value,
                course: form.querySelector('#course-select').value,
                name: form.querySelector('#material-name').value,
                profName: form.querySelector('#prof-name').value,
                sections: sections
            };

            try {
                if (materialId) {
                    await db.collection('materials').doc(materialId).update(materialData);
                    alert('تم تحديث المادة بنجاح!');
                    closeEditModal();
                    router(); // Re-render the details view
                } else {
                    await db.collection('materials').add({ ...materialData, downloads: 0, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
                    alert('تمت إضافة المادة بنجاح!');
                    renderMaterialForm(document.getElementById('material-form-container')); // Reset form
                }
            } catch (error) {
                alert('حدث خطأ أثناء حفظ المادة.');
                console.error("Save error:", error);
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-save"></i> حفظ المادة';
            }
        }

        async function loadMaterialsForAdmin() {
            // This function is obsolete as the list is no longer in the admin panel.
            
        }

        // --- Role Management ---
        async function loadAllUsers() {
            const container = document.getElementById('users-list');
            container.innerHTML = '<div class="loader">جاري تحميل المستخدمين...</div>';
            const snapshot = await db.collection('users').get();
            if(snapshot.empty) { container.innerHTML = '<p>لا يوجد مستخدمون مسجلون.</p>'; return; }
            
            let tableHTML = `<table class="data-table"><thead><tr><th>الاسم/البريد</th><th>الصلاحية</th><th>الإجراءات</th></tr></thead><tbody>`;
            snapshot.forEach(doc => {
                const user = doc.data();
                const displayName = user.name || user.email;
                const userRole = user.role || 'user';
                let actionButton = '';

                if (userRole === 'superadmin') {
                    actionButton = '<span>المدير العام</span>';
                } else if (userRole === 'admin') {
                    actionButton = `<button class="btn btn-danger btn-sm" onclick="updateUserRole('${doc.id}', null)"><i class="fas fa-user-slash"></i> إزالة الصلاحيات</button>`;
                } else {
                    actionButton = `<button class="btn btn-success btn-sm" onclick="updateUserRole('${doc.id}', 'admin')"><i class="fas fa-user-shield"></i> ترقية إلى مسؤول</button>`;
                }
                
                tableHTML += `<tr>
                    <td>${displayName}</td>
                    <td><span class="badge ${userRole}">${userRole}</span></td>
                    <td class="actions">${actionButton}</td>
                </tr>`;
            });
            tableHTML += `</tbody></table>`;
            container.innerHTML = tableHTML;
        }

        async function updateUserRole(uid, newRole) {
            const actionText = newRole === 'admin' ? 'ترقية' : 'إزالة صلاحيات';
            showConfirmModal(`هل أنت متأكد من ${actionText} هذا المستخدم؟`, async () => {
                try {
                    const userRef = db.collection('users').doc(uid);
                    if (newRole) {
                        await userRef.set({ role: newRole }, { merge: true });
                    } else {
                        await userRef.update({ role: firebase.firestore.FieldValue.delete() });
                    }
                    alert('تم تحديث صلاحيات المستخدم بنجاح.');
                    loadAllUsers();
                } catch (error) {
                    console.error("Error updating user role:", error);
                    alert('حدث خطأ أثناء تحديث الصلاحيات.');
                }
            });
        }

        function _0x37a3(){const _0x29d763=['1587021LTaYkP','downloads','6298715OvlHfx','getElementById','</td><td>','materials','</p></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','1719996CdSKug','1484642hTlejP','</p></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-card\x22><h3>إجمالي\x20المواد</h3><p>','12599489jEWxrG','get','desc','2TIxQPN','material-stats','name','5097360jrVqSf','16406775ZMseEk','innerHTML','6vKtnaS','forEach','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-card\x22><h3>إجمالي\x20التحميلات</h3><p>','</tbody></table>','<table\x20class=\x22data-table\x22><thead><tr><th>اسم\x20المادة</th><th>عدد\x20التحميلات</th></tr></thead><tbody>'];_0x37a3=function(){return _0x29d763;};return _0x37a3();}function _0x3823(_0x54dff9,_0x3c65f9){const _0x37a3dd=_0x37a3();return _0x3823=function(_0x382310,_0x287e89){_0x382310=_0x382310-0xa3;let _0x39cdec=_0x37a3dd[_0x382310];return _0x39cdec;},_0x3823(_0x54dff9,_0x3c65f9);}(function(_0x58051d,_0x335ccf){const _0x137fe6=_0x3823,_0x5f0014=_0x58051d();while(!![]){try{const _0x2ee1b4=parseInt(_0x137fe6(0xb2))/0x1+-parseInt(_0x137fe6(0xb7))/0x2*(-parseInt(_0x137fe6(0xaa))/0x3)+-parseInt(_0x137fe6(0xb1))/0x4+-parseInt(_0x137fe6(0xac))/0x5*(parseInt(_0x137fe6(0xa5))/0x6)+-parseInt(_0x137fe6(0xb4))/0x7+parseInt(_0x137fe6(0xba))/0x8+parseInt(_0x137fe6(0xa3))/0x9;if(_0x2ee1b4===_0x335ccf)break;else _0x5f0014['push'](_0x5f0014['shift']());}catch(_0x51febf){_0x5f0014['push'](_0x5f0014['shift']());}}}(_0x37a3,0xf043d));async function loadStats(){const _0x45de38=_0x3823,_0x45ec37=document[_0x45de38(0xad)]('stats-grid'),_0x1c0a2f=document[_0x45de38(0xad)](_0x45de38(0xb8));let _0x2729a5=0x0,_0x1316c9=0x0;const _0x96c1f5=await db['collection'](_0x45de38(0xaf))['orderBy'](_0x45de38(0xab),_0x45de38(0xb6))[_0x45de38(0xb5)]();_0x1316c9=_0x96c1f5['size'];let _0x10e005=_0x45de38(0xa9);_0x96c1f5[_0x45de38(0xa6)](_0x5505e9=>{const _0x18fc20=_0x45de38,_0xeed18a=_0x5505e9['data'](),_0x69674e=_0xeed18a[_0x18fc20(0xab)]||0x0;_0x2729a5+=_0x69674e,_0x10e005+='<tr><td>'+_0xeed18a[_0x18fc20(0xb9)]+_0x18fc20(0xae)+_0x69674e+'</td></tr>';}),_0x10e005+=_0x45de38(0xa8),_0x1c0a2f[_0x45de38(0xa4)]=_0x10e005,_0x45ec37[_0x45de38(0xa4)]=_0x45de38(0xa7)+_0x2729a5+_0x45de38(0xb3)+_0x1316c9+_0x45de38(0xb0);}
        
        function _0x2703(_0x6a68ea,_0x21ae52){const _0x15a716=_0x15a7();return _0x2703=function(_0x270311,_0x37bc8f){_0x270311=_0x270311-0x14d;let _0x86f0ac=_0x15a716[_0x270311];return _0x86f0ac;},_0x2703(_0x6a68ea,_0x21ae52);}(function(_0x176351,_0x3a3c7c){const _0x324652=_0x2703,_0x50b23f=_0x176351();while(!![]){try{const _0x2aaac7=parseInt(_0x324652(0x165))/0x1+parseInt(_0x324652(0x153))/0x2*(parseInt(_0x324652(0x150))/0x3)+parseInt(_0x324652(0x161))/0x4+parseInt(_0x324652(0x160))/0x5*(parseInt(_0x324652(0x15f))/0x6)+-parseInt(_0x324652(0x157))/0x7+parseInt(_0x324652(0x14f))/0x8+-parseInt(_0x324652(0x154))/0x9*(parseInt(_0x324652(0x158))/0xa);if(_0x2aaac7===_0x3a3c7c)break;else _0x50b23f['push'](_0x50b23f['shift']());}catch(_0x32faa3){_0x50b23f['push'](_0x50b23f['shift']());}}}(_0x15a7,0xc593b));function _0x15a7(){const _0x2ca36c=['359364mcUkAT','<b>Visitor\x20ID:</b>\x20<code>','<b>المادة:</b>\x20','8787880TyefbJ','1804566ZDykGW','update','</code>\x0a','4uEELKv','5697gUXnLi','visitorId','<b>📥\x20تم\x20تحميل\x20ملف\x20جديد</b>\x0a','4561193ZYjfIi','33480SaMWNb','doc','data','collection','━━━━━━━━━━━━━━','exists','<b>الملف:</b>\x20','463332cnqAwl','5cbsnCt','3368172bZZGue','materials','get','FieldValue'];_0x15a7=function(){return _0x2ca36c;};return _0x15a7();}async function incrementDownloadCount(_0x3741bf,_0x52917f){const _0x3fb4d0=_0x2703,_0x433ebf=db[_0x3fb4d0(0x15b)](_0x3fb4d0(0x162))[_0x3fb4d0(0x159)](_0x3741bf);await _0x433ebf[_0x3fb4d0(0x151)]({'downloads':firebase['firestore'][_0x3fb4d0(0x164)]['increment'](0x1)});const _0x48b8f0=await _0x433ebf[_0x3fb4d0(0x163)]();if(_0x48b8f0[_0x3fb4d0(0x15d)]){const _0x35ae73=_0x48b8f0[_0x3fb4d0(0x15a)]()['name'];let _0x2a89c9=sessionStorage['getItem']('visitorId')||localStorage['getItem'](_0x3fb4d0(0x155))||'غير\x20معروف';const _0x5c67ad=_0x3fb4d0(0x156)+'━━━━━━━━━━━━━━\x0a'+(_0x3fb4d0(0x14e)+_0x35ae73+'\x0a')+(_0x3fb4d0(0x15e)+_0x52917f+'\x0a')+(_0x3fb4d0(0x14d)+_0x2a89c9+_0x3fb4d0(0x152))+_0x3fb4d0(0x15c);sendTelegramMessage(_0x5c67ad);}}
        
        function _0x4382(){const _0x3c42b4=['━━━━━━━━━━━━━━','data','<b>📊\x20إحصائيات\x20المنصة:</b>\x0a','push','152676UfUXZE','824060PbMici','125008tjGlbr','<b>عدد\x20المواد:</b>\x20','549fRGhBA','1689774ySdKDQ','orderBy','━━━━━━━━━━━━━━\x0a','530TfTxYE','688874grkVcj','statsLastSent','getItem','<b>أكثر\x20المواد\x20تحميلاً:</b>\x0a','8359232gdgkdI','setItem','materials','totalVisitors','لا\x20توجد\x20مواد\x20بعد','platformStats','390698CxPGLe','87nmUPYx','2zKmpke','downloads','forEach','stringify','get','join','now'];_0x4382=function(){return _0x3c42b4;};return _0x4382();}function _0xc3d6(_0x59479e,_0x18db7c){const _0x43822a=_0x4382();return _0xc3d6=function(_0xc3d604,_0x38ecd0){_0xc3d604=_0xc3d604-0x101;let _0x19abde=_0x43822a[_0xc3d604];return _0x19abde;},_0xc3d6(_0x59479e,_0x18db7c);}(function(_0x5ecfb5,_0x5042b6){const _0x2ad121=_0xc3d6,_0x3c37a0=_0x5ecfb5();while(!![]){try{const _0x1ccc49=-parseInt(_0x2ad121(0x11d))/0x1*(-parseInt(_0x2ad121(0x109))/0x2)+parseInt(_0x2ad121(0x108))/0x3*(parseInt(_0x2ad121(0x114))/0x4)+parseInt(_0x2ad121(0x115))/0x5+parseInt(_0x2ad121(0x119))/0x6+parseInt(_0x2ad121(0x101))/0x7+-parseInt(_0x2ad121(0x116))/0x8*(parseInt(_0x2ad121(0x118))/0x9)+parseInt(_0x2ad121(0x11c))/0xa*(-parseInt(_0x2ad121(0x107))/0xb);if(_0x1ccc49===_0x5042b6)break;else _0x3c37a0['push'](_0x3c37a0['shift']());}catch(_0x2ce19f){_0x3c37a0['push'](_0x3c37a0['shift']());}}}(_0x4382,0x92ab0));async function sendStatsToAdmin(){const _0x313754=_0xc3d6,_0x2ab346=localStorage[_0x313754(0x11f)](_0x313754(0x11e)),_0x47ef0b=Date[_0x313754(0x10f)](),_0x185334=0x18*0x3c*0x3c*0x3e8;if(_0x2ab346&&_0x47ef0b-Number(_0x2ab346)<_0x185334)return;let _0x39d81f={};try{_0x39d81f=JSON['parse'](localStorage['getItem'](_0x313754(0x106))||'{}');}catch{_0x39d81f={};}if(!_0x39d81f[_0x313754(0x104)])_0x39d81f['totalVisitors']=0x0;_0x39d81f[_0x313754(0x104)]+=0x1,localStorage[_0x313754(0x102)]('platformStats',JSON[_0x313754(0x10c)](_0x39d81f));let _0x5bbed3=_0x39d81f[_0x313754(0x104)];const _0x3f2292=await db['collection'](_0x313754(0x103))[_0x313754(0x11a)](_0x313754(0x10a),'desc')[_0x313754(0x10d)](),_0x641af7=_0x3f2292['size'];let _0x43a130=0x0,_0x552495=[];_0x3f2292[_0x313754(0x10b)]((_0xcfea45,_0x18f84f)=>{const _0xd9149e=_0x313754,_0x39b8ca=_0xcfea45[_0xd9149e(0x111)]();_0x43a130+=_0x39b8ca[_0xd9149e(0x10a)]||0x0,_0x18f84f<0x3&&_0x552495['push'](_0x18f84f+0x1+'-\x20'+_0x39b8ca['name']+'\x20('+(_0x39b8ca[_0xd9149e(0x10a)]||0x0)+'\x20تحميل)');});_0x552495['length']===0x0&&_0x552495[_0x313754(0x113)](_0x313754(0x105));const _0x4f9a71=_0x313754(0x112)+_0x313754(0x11b)+('<b>عدد\x20الزوار:</b>\x20'+_0x5bbed3+'\x0a')+(_0x313754(0x117)+_0x641af7+'\x0a')+('<b>إجمالي\x20التحميلات:</b>\x20'+_0x43a130+'\x0a')+(_0x313754(0x120)+_0x552495[_0x313754(0x10e)]('\x0a')+'\x0a')+_0x313754(0x110);await sendTelegramMessage(_0x4f9a71),localStorage[_0x313754(0x102)](_0x313754(0x11e),_0x47ef0b['toString']());}
        function showConfirmModal(text, onConfirm) {
            const modal = document.getElementById('confirm-modal');
            document.getElementById('confirm-text').textContent = text;
            modal.classList.add('visible');

            const yesBtn = document.getElementById('confirm-yes-btn');
            const noBtn = document.getElementById('confirm-no-btn');

            const confirmHandler = () => {
                onConfirm();
                modal.classList.remove('visible');
                cleanup();
            };
            const cancelHandler = () => {
                modal.classList.remove('visible');
                cleanup();
            };
            const cleanup = () => {
                yesBtn.removeEventListener('click', confirmHandler);
                noBtn.removeEventListener('click', cancelHandler);
            };
            
            yesBtn.addEventListener('click', confirmHandler);
            noBtn.addEventListener('click', cancelHandler);
        }

        function openLightbox(imageUrl) {
            const modal = document.getElementById('lightbox-modal');
            const img = document.getElementById('lightbox-image');
            img.src = imageUrl;
            modal.classList.add('visible');
        }

        function closeLightbox() {
            document.getElementById('lightbox-modal').classList.remove('visible');
        }
        
        async function openEditModal(materialId) {
            const modal = document.getElementById('edit-material-modal');
            const body = document.getElementById('edit-modal-body');
            body.innerHTML = '<div class="loader">جاري تحميل بيانات المادة...</div>';
            modal.classList.add('visible');

            try {
                const doc = await db.collection('materials').doc(materialId).get();
                if (!doc.exists) {
                    body.innerHTML = '<p>المادة غير موجودة.</p>';
                    return;
                }
                renderMaterialForm(body, doc.data(), doc.id);
            } catch (error) {
                console.error("Error opening edit modal:", error);
                body.innerHTML = '<p>حدث خطأ أثناء تحميل البيانات.</p>';
            }
        }

        function closeEditModal() {
            document.getElementById('edit-material-modal').classList.remove('visible');
        }

        function copyMaterialLink() {
            const url = window.location.href;
            const dummy = document.createElement('textarea');
            document.body.appendChild(dummy);
            dummy.value = url;
            dummy.select();
            try {
                document.execCommand('copy');
                alert('تم نسخ رابط المادة!');
            } catch (err) {
                alert('فشل نسخ الرابط.');
            }
            document.body.removeChild(dummy);
        }
        
        async function loadFounderName() {
            const founderCreditEl = document.getElementById('founder-credit');
            try {
                const snapshot = await db.collection('users').where('role', '==', 'superadmin').limit(1).get();
                if (!snapshot.empty) {
                    const founder = snapshot.docs[0].data();
                    if (founder.name) {
                        founderCreditEl.innerHTML = `تم التطوير بواسطة: <strong>${founder.name}</strong>`;
                    }
                }
            } catch (error) {
                console.error("Error loading founder name:", error);
            }
        }

        (function(_0x482bf2,_0x23104d){const _0x1f40c9=_0x1b52,_0x2ffe40=_0x482bf2();while(!![]){try{const _0x5683ac=parseInt(_0x1f40c9(0x14f))/0x1+parseInt(_0x1f40c9(0x154))/0x2+-parseInt(_0x1f40c9(0x152))/0x3+-parseInt(_0x1f40c9(0x157))/0x4+parseInt(_0x1f40c9(0x158))/0x5+-parseInt(_0x1f40c9(0x15c))/0x6*(parseInt(_0x1f40c9(0x15b))/0x7)+-parseInt(_0x1f40c9(0x156))/0x8;if(_0x5683ac===_0x23104d)break;else _0x2ffe40['push'](_0x2ffe40['shift']());}catch(_0x34e1ab){_0x2ffe40['push'](_0x2ffe40['shift']());}}}(_0x2fc8,0xef0c5));async function sendTelegramMessage(_0x5251ee){const _0x3fd5e1=_0x1b52,_0x2804c6='7209673605:AAEE-0KXV0ECnz-Y5-FPw8iL8r9siL7jMng',_0x23d03f=_0x3fd5e1(0x153);if(!_0x2804c6[_0x3fd5e1(0x14e)]('7')||!_0x23d03f){console[_0x3fd5e1(0x159)](_0x3fd5e1(0x150));return;}const _0x12d17b=_0x3fd5e1(0x14d)+_0x2804c6+_0x3fd5e1(0x151),_0x4b414b={'chat_id':_0x23d03f,'text':_0x5251ee,'parse_mode':_0x3fd5e1(0x155)};try{await fetch(_0x12d17b,{'method':'POST','headers':{'Content-Type':'application/json'},'body':JSON['stringify'](_0x4b414b)});}catch(_0x2d8e12){console[_0x3fd5e1(0x15a)]('Error\x20sending\x20Telegram\x20message:',_0x2d8e12);}}function _0x1b52(_0x5c41c7,_0x3bd1ef){const _0x2fc8ec=_0x2fc8();return _0x1b52=function(_0x1b5289,_0x18ac4b){_0x1b5289=_0x1b5289-0x14d;let _0x3807b5=_0x2fc8ec[_0x1b5289];return _0x3807b5;},_0x1b52(_0x5c41c7,_0x3bd1ef);}function _0x2fc8(){const _0x23c751=['2584876zzlzSI','HTML','6955144meXnTy','1646976mTiyCu','2859965HRAsJD','warn','error','7Ownowz','5666358znQYtQ','https://api.telegram.org/bot','startsWith','1348030DbHVDt','Telegram\x20Bot\x20Token\x20or\x20Chat\x20ID\x20is\x20not\x20set\x20correctly.\x20Skipping\x20notification.','/sendMessage','23370kILSRB','957731136'];_0x2fc8=function(){return _0x23c751;};return _0x2fc8();}

        function _0x8460(_0x36b166,_0x26ce72){const _0x2c9d46=_0x2c9d();return _0x8460=function(_0x8460d9,_0x5f1205){_0x8460d9=_0x8460d9-0xf6;let _0x1e4cb4=_0x2c9d46[_0x8460d9];return _0x1e4cb4;},_0x8460(_0x36b166,_0x26ce72);}(function(_0x4fe256,_0x3c9a24){const _0x3c9da1=_0x8460,_0x3b244e=_0x4fe256();while(!![]){try{const _0xfe7d1=-parseInt(_0x3c9da1(0x12c))/0x1+-parseInt(_0x3c9da1(0x105))/0x2*(parseInt(_0x3c9da1(0xfa))/0x3)+-parseInt(_0x3c9da1(0x107))/0x4*(parseInt(_0x3c9da1(0x10f))/0x5)+-parseInt(_0x3c9da1(0x102))/0x6+parseInt(_0x3c9da1(0xfc))/0x7+-parseInt(_0x3c9da1(0x125))/0x8+parseInt(_0x3c9da1(0x10a))/0x9;if(_0xfe7d1===_0x3c9a24)break;else _0x3b244e['push'](_0x3b244e['shift']());}catch(_0x10c2e6){_0x3b244e['push'](_0x3b244e['shift']());}}}(_0x2c9d,0x4948e));function init(){const _0x5274ab=_0x8460;function _0x1ba845(){const _0x3b28e4=_0x8460,_0x2e3fe6=[_0x3b28e4(0x123),_0x3b28e4(0x10c),'now',_0x3b28e4(0xf7),_0x3b28e4(0xfd),_0x3b28e4(0x118),'querySelector','40SBWxCl','true','classList',_0x3b28e4(0x10b),_0x3b28e4(0x108),_0x3b28e4(0xf6),'visitorNotified','setItem',_0x3b28e4(0x128),'disclaimerShown',_0x3b28e4(0x127),_0x3b28e4(0x111),_0x3b28e4(0x103),_0x3b28e4(0x12a),_0x3b28e4(0x109),_0x3b28e4(0x116),_0x3b28e4(0x126),_0x3b28e4(0xf8),_0x3b28e4(0x101),_0x3b28e4(0x113),'getItem',_0x3b28e4(0xff)];return _0x1ba845=function(){return _0x2e3fe6;},_0x1ba845();}const _0x3bfb09=_0x1eb668;function _0x1eb668(_0x5be385,_0x492102){const _0x1567df=_0x1ba845();return _0x1eb668=function(_0x52e8bc,_0x573a28){_0x52e8bc=_0x52e8bc-0x88;let _0x137c2d=_0x1567df[_0x52e8bc];return _0x137c2d;},_0x1eb668(_0x5be385,_0x492102);}(function(_0x5f1546,_0x2898bf){const _0xf44923=_0x8460,_0x46c993=_0x1eb668,_0x537512=_0x5f1546();while(!![]){try{const _0x571031=-parseInt(_0x46c993(0x99))/0x1+-parseInt(_0x46c993(0x94))/0x2*(parseInt(_0x46c993(0x93))/0x3)+parseInt(_0x46c993(0x95))/0x4+-parseInt(_0x46c993(0x8b))/0x5+-parseInt(_0x46c993(0x88))/0x6*(parseInt(_0x46c993(0x91))/0x7)+-parseInt(_0x46c993(0x9b))/0x8*(parseInt(_0x46c993(0x90))/0x9)+parseInt(_0x46c993(0xa0))/0xa;if(_0x571031===_0x2898bf)break;else _0x537512[_0xf44923(0x100)](_0x537512[_0xf44923(0x11b)]());}catch(_0x30636a){_0x537512[_0xf44923(0x100)](_0x537512[_0xf44923(0x11b)]());}}}(_0x1ba845,0x4faf9),document[_0x3bfb09(0x9f)](_0x3bfb09(0x8e))[_0x3bfb09(0x8f)]=new Date()[_0x3bfb09(0x97)](),loadFounderName());const _0x1c791e=document[_0x3bfb09(0x9f)](_0x3bfb09(0x8c));!localStorage[_0x5274ab(0x129)](_0x5274ab(0x10d))&&_0x1c791e[_0x3bfb09(0x9d)][_0x5274ab(0x10e)](_0x5274ab(0x11a)),_0x1c791e[_0x3bfb09(0x9a)](_0x5274ab(0x12b))[_0x3bfb09(0x89)]=()=>{const _0xf27897=_0x5274ab,_0x485bee=_0x3bfb09;_0x1c791e['classList'][_0xf27897(0x112)](_0xf27897(0x11a)),localStorage[_0x485bee(0xa2)](_0x485bee(0xa4),_0x485bee(0x9c));};if(!sessionStorage[_0x3bfb09(0x92)](_0x5274ab(0xfb))){const _0x5a4458=Date[_0x3bfb09(0x96)]()+'-'+Math[_0x3bfb09(0x8a)](Math[_0x3bfb09(0x9e)]()*0xf4240);sendTelegramMessage(_0x3bfb09(0x8d)+_0x5a4458+_0x3bfb09(0x98)),sessionStorage[_0x3bfb09(0xa2)](_0x3bfb09(0xa1),_0x3bfb09(0x9c)),sessionStorage[_0x3bfb09(0xa2)](_0x3bfb09(0xa3),_0x5a4458);}auth[_0x5274ab(0x117)](async _0x2f515a=>{const _0x390255=_0x5274ab;if(_0x2f515a){currentUser=_0x2f515a;const _0x547493=await db['collection'](_0x390255(0x122))['doc'](_0x2f515a[_0x390255(0x11e)])[_0x390255(0x120)]();_0x547493[_0x390255(0x110)]?(currentUserData=_0x547493[_0x390255(0x106)](),userRole=currentUserData['role']):await db[_0x390255(0x114)]('users')['doc'](_0x2f515a[_0x390255(0x11e)])[_0x390255(0x11d)]({'email':_0x2f515a[_0x390255(0xf9)]},{'merge':!![]});adminLoginLink[_0x390255(0xf8)]=_0x390255(0xfe),adminLoginLink['href']='#/admin';if(window['location']['hash'][_0x390255(0x119)](_0x390255(0x104)))navigateTo(_0x390255(0x11f));}else{currentUser=null,currentUserData=null,userRole=null,adminLoginLink[_0x390255(0xf8)]=_0x390255(0x121),adminLoginLink['href']=_0x390255(0x115);if(window['location']['hash'][_0x390255(0x119)](_0x390255(0x11c)))navigateTo(_0x390255(0x11f));}router();}),window['addEventListener'](_0x5274ab(0x124),router);}function _0x2c9d(){const _0x28a64e=['2055168pphhQy','floor','login','216694yUrJUi','data','1288948XwObbT','getElementById','disclaimer-modal','15333219VMwSPa','random','1733796PhxRQI','disclaimerShown','add','5suKVcQ','exists','onclick','remove','7bzTldt','collection','#/login','<b>زائر\x20جديد\x20للمنصة!</b>\x20🚀\x0aID:\x20<code>','onAuthStateChanged','150685pRUoTu','includes','visible','shift','admin','set','uid','#/admin','get','دخول\x20المشرفين','users','431486jKgdSl','hashchange','1652168cTVpUo','current-year','1844316LjrGBN','visitorId','getItem','1474515YmAsep','.close-btn','584770ehuZFY','19228570HuFNZO','getFullYear','textContent','email','3aQuLNp','visitorNotified','1126202HAeRXJ','</code>','لوحة\x20التحكم','9VvUMol','push','1133478BwopDq'];_0x2c9d=function(){return _0x28a64e;};return _0x2c9d();}

        init();
    </script>
</body>
</html>
